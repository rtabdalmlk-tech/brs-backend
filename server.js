// server.js

const express = require('express');
const cors = require('cors');
const dotenv = require('dotenv');

dotenv.config();

const app = express();
const PORT = process.env.PORT || 3000;
const GEMINI_API_KEY = process.env.GEMINI_API_KEY;

if (!GEMINI_API_KEY) {
  console.warn('âš ï¸ Ù…ØªØºÙŠØ± Ø§Ù„Ø¨ÙŠØ¦Ø© GEMINI_API_KEY ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.');
}

app.use(cors());
app.use(express.json({ limit: '25mb' }));

// Ø¨Ø±ÙˆÙ…Ø¨Øª Ø´Ø±Ø­ Ø§Ù„Ø¯Ø±ÙˆØ³
function getExamPrompt() {
  return `
Ø£Ù†Øª Ø¯ÙƒØªÙˆØ± Ø¬Ø§Ù…Ø¹ÙŠ Ù„Ù…Ø§Ø¯Ø© Ù…Ø¨Ø§Ø¯Ø¦ Ù…Ø­Ø§Ø³Ø¨Ø© 1ØŒ ÙˆØªØ±ÙŠØ¯ Ø¥Ø¹Ø¯Ø§Ø¯ "Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¬Ø§Ø¨Ø© Ø±Ø³Ù…ÙŠ ÙˆÙ…Ù†Ø³Ù‚" Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØŒ Ø¨Ø­ÙŠØ« ÙŠÙƒÙˆÙ† Ø§Ù„Ø­Ù„ ÙˆØ§Ø¶Ø­Ù‹Ø§ Ø¬Ø¯Ù‹Ø§ Ù„Ù„Ø·Ø§Ù„Ø¨ØŒ ÙˆÙ…Ù†Ø³Ù‚Ù‹Ø§ Ù…Ø«Ù„ Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ©.

Ø£Ù…Ø§Ù…Ùƒ Ù…Ù„Ù PDF ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø± ØªØ­ØªÙˆÙŠ Ø¹Ø§Ø¯Ø© Ø¹Ù„Ù‰:
- Ø£Ø³Ø¦Ù„Ø© Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯.
- Ø¹Ù…Ù„ÙŠØ§Øª Ù„Ø´Ø±ÙƒØ© (ØªØ³Ø¬ÙŠÙ„ Ù‚ÙŠÙˆØ¯ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©).
- Ù…ÙŠØ²Ø§Ù† Ù…Ø±Ø§Ø¬Ø¹Ø©ØŒ ÙˆÙ…Ø·Ù„ÙˆØ¨ Ù…Ù†Ù‡ Ø¥Ø¹Ø¯Ø§Ø¯ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø®Ù„ ÙˆÙ‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø§Ù„ÙŠ.

========================
Ø£ÙˆÙ„Ø§Ù‹: Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£ÙˆÙ„ â€“ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
========================

Ù„ÙƒÙ„ Ø³Ø¤Ø§Ù„ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯ØŒ Ø§ÙƒØªØ¨ Ø§Ù„Ø­Ù„ Ø¨Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ù„ÙŠ:

Ø§Ù„Ø³Ø¤Ø§Ù„ (Ø±Ù‚Ù…):
Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: (Ø§ÙƒØªØ¨ Ø­Ø±Ù Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„ØµØ­ÙŠØ­ Ù…Ø«Ù„ (Ø£)ØŒ (Ø¨)ØŒ (Ø¬)ØŒ (Ø¯))
Ø§Ù„ØªÙØ³ÙŠØ± Ø§Ù„Ù…Ø®ØªØµØ±:
- Ø³Ø·Ø± ÙŠÙˆØ¶Ø­ Ù„Ù…Ø§Ø°Ø§ Ù‡Ø°Ø§ Ø§Ù„Ø®ÙŠØ§Ø± Ù‡Ùˆ Ø§Ù„ØµØ­ÙŠØ­.
- Ù„Ø§ ØªØ·ÙŠÙ„ Ø§Ù„Ø´Ø±Ø­.

â‡¨ Ø§ØªØ±Ùƒ Ø³Ø·Ø± ÙØ§Ø±Øº Ø¨ÙŠÙ† ÙƒÙ„ Ø³Ø¤Ø§Ù„ ÙˆØ§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø°ÙŠ Ø¨Ø¹Ø¯Ù‡.

========================
Ø«Ø§Ù†ÙŠØ§Ù‹: Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø«Ø§Ù†ÙŠ â€“ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø´Ø±ÙƒØ© ÙˆÙ‚ÙŠÙˆØ¯ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
========================

Ù„ÙƒÙ„ Ø¹Ù…Ù„ÙŠØ© ÙÙŠ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø«Ø§Ù†ÙŠØŒ Ø§ÙƒØªØ¨ Ø§Ù„Ø­Ù„ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ:

Ø§Ù„Ø¹Ù…Ù„ÙŠØ© (Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ©):
Ø§Ù„Ù…Ø¹Ø·ÙŠØ§Øª:
- Ø§ÙƒØªØ¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ù…Ø°ÙƒÙˆØ±Ø© ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©.

Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø­Ù„:
1) ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© (Ø´Ø±Ø§Ø¡ Ø¨Ø¶Ø§Ø¹Ø©ØŒ Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„ØŒ Ù…ØµØ±ÙˆÙØŒ Ø¥ÙŠØ±Ø§Ø¯â€¦).
2) ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª (ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¯ÙŠÙ† ÙˆØ§Ù„Ø¯Ø§Ø¦Ù†).
3) Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø®ØµÙ… ØªØ¬Ø§Ø±ÙŠ Ø£Ùˆ Ù†Ù‚Ø¯ÙŠØŒ Ø§Ø­Ø³Ø¨Ù‡ Ø¨ÙˆØ¶ÙˆØ­:
   Ù…Ø«Ù„Ù‹Ø§: 
   ØµØ§ÙÙŠ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª = Ø§Ù„Ù…Ø¨Ù„Øº Ã— (1 - Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ…)

Ù‚ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©:
Ø§ÙƒØªØ¨Ù‡ Ø¨Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ù†ØµÙŠ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ Ù‡ÙƒØ°Ø§:

Ù…Ù† Ø­/ (Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¯ÙŠÙ†)
   Ø¥Ù„Ù‰ Ø­/ (Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¯Ø§Ø¦Ù†)

â‡¨ Ø§ØªØ±Ùƒ Ø³Ø·Ø± ÙØ§Ø±Øº Ø¨ÙŠÙ† ÙƒÙ„ Ø¹Ù…Ù„ÙŠØ© ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ©.

========================
Ø«Ø§Ù„Ø«Ø§Ù‹: Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø«Ø§Ù„Ø« â€“ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ø§Ù„ÙŠØ©
========================

Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø«Ø§Ù„Ø« Ù…ÙŠØ²Ø§Ù† Ù…Ø±Ø§Ø¬Ø¹Ø©ØŒ ÙØ§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø¥Ø¹Ø¯Ø§Ø¯:

-------------------------
1) Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø®Ù„ (Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø±)
-------------------------

Ø£ÙƒØªØ¨Ù‡Ø§ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø´ÙƒÙ„:

Ø£ÙˆÙ„Ø§Ù‹: Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª
- ØµØ§ÙÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª: ...
- Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø£Ø®Ø±Ù‰: ...

Ø«Ø§Ù†ÙŠØ§Ù‹: ØªÙƒÙ„ÙØ© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
- Ù…Ø®Ø²ÙˆÙ† Ø£ÙˆÙ„ Ø§Ù„Ù…Ø¯Ø©: ...
- + ØµØ§ÙÙŠ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª: ...
- = Ø¨Ø¶Ø§Ø¹Ø© Ù…ØªØ§Ø­Ø© Ù„Ù„Ø¨ÙŠØ¹: ...
- - Ù…Ø®Ø²ÙˆÙ† Ø¢Ø®Ø± Ø§Ù„Ù…Ø¯Ø©: ...
= ØªÙƒÙ„ÙØ© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª: ...

Ù…Ø¬Ù…Ù„ Ø§Ù„Ø±Ø¨Ø­ = ØµØ§ÙÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª - ØªÙƒÙ„ÙØ© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª

Ø«Ø§Ù„Ø«Ø§Ù‹: Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©
- Ù…ØµØ±ÙˆÙ Ø§Ù„Ø±ÙˆØ§ØªØ¨: ...
- Ù…ØµØ±ÙˆÙ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±: ...

ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ = Ù…Ø¬Ù…Ù„ Ø§Ù„Ø±Ø¨Ø­ - Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©

-------------------------
2) Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø§Ù„ÙŠ
-------------------------

Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ù…ØªØ¯Ø§ÙˆÙ„Ø©:
- Ù†Ù‚Ø¯ÙŠØ© Ø¨Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚: ...
- Ù†Ù‚Ø¯ÙŠØ© Ø¨Ø§Ù„Ø¨Ù†Ùƒ: ...
- Ø§Ù„Ù…Ø¯ÙŠÙ†ÙˆÙ†: ...
- Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: ...
- Ø£ÙˆØ±Ø§Ù‚ Ø§Ù„Ù‚Ø¨Ø¶: ...

Ø§Ù„Ø£ØµÙˆÙ„ ØºÙŠØ± Ø§Ù„Ù…ØªØ¯Ø§ÙˆÙ„Ø©:
- Ø£Ø±Ø§Ø¶ÙŠ: ...
- Ù…Ø¨Ø§Ù†ÙŠ: ...
- Ù…Ø¹Ø¯Ø§Øª: ...
- Ø£Ø«Ø§Ø«: ...

Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ØµÙˆÙ„: ...

Ø§Ù„Ø®ØµÙˆÙ… Ø§Ù„Ù…ØªØ¯Ø§ÙˆÙ„Ø©:
- Ø§Ù„Ø¯Ø§Ø¦Ù†ÙˆÙ†: ...
- Ø£ÙˆØ±Ø§Ù‚ Ø§Ù„Ø¯ÙØ¹: ...

Ø§Ù„Ø®ØµÙˆÙ… Ø·ÙˆÙŠÙ„Ø© Ø§Ù„Ø£Ø¬Ù„:
- Ù‚Ø±Ø¶ Ø·ÙˆÙŠÙ„ Ø§Ù„Ø£Ø¬Ù„: ...

Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ù„ÙƒÙŠØ©:
- Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„: ...
- + ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ (Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø®Ù„)

Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ù„ÙƒÙŠØ©: ...

ØªØ°ÙƒÙŠØ±:
ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ³Ø§ÙˆÙŠ:
Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ØµÙˆÙ„ = Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙˆÙ… + Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ù„ÙƒÙŠØ©

========================
ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„ØªÙ†Ø³ÙŠÙ‚
========================

- Ù„Ø§ ØªØ¯Ù…Ø¬ Ø£ÙƒØ«Ø± Ù…Ù† Ø³Ø¤Ø§Ù„ ÙÙŠ ÙÙ‚Ø±Ø© ÙˆØ§Ø­Ø¯Ø©.
- Ø§ÙØµÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ø®Ø· ÙˆØ§Ø¶Ø­ Ù…Ø«Ù„: 
  -------------------------
- Ø§ÙƒØªØ¨ Ø§Ù„Ø­Ù„ Ø¨Ø®Ø·ÙˆØ§Øª ÙˆÙ†Ù‚Ø§Ø·ØŒ ÙˆÙ„ÙŠØ³ Ø¨Ø´ÙƒÙ„ ÙÙ‚Ø±Ø© Ø·ÙˆÙŠÙ„Ø©.
- Ø¥Ø°Ø§ ÙƒØ§Ù† Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„ ØºÙŠØ± ÙˆØ§Ø¶Ø­ Ø£Ùˆ Ù…ÙÙ‚ÙˆØ¯ ÙÙŠ PDFØŒ Ø§ÙƒØªØ¨:
  "Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ ØºÙŠØ± ÙˆØ§Ø¶Ø­ ÙÙŠ Ø§Ù„Ù…Ù„Ù ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ù„Ù‡ Ø¨Ø¯Ù‚Ø©."

Ù‡Ø¯ÙÙƒ Ø¥Ø®Ø±Ø§Ø¬ Ø­Ù„Ù‘ Ù…Ø±ØªØ¨ ÙˆØ£Ù†ÙŠÙ‚ ÙˆØ³Ù‡Ù„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©ØŒ ÙƒÙ…Ø§ Ù„Ùˆ Ø£Ù†Ù‡ Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¬Ø§Ø¨Ø© Ø±Ø³Ù…ÙŠ Ù…Ø¹ØªÙ…Ø¯ Ù…Ù† ÙƒÙ„ÙŠØ© Ø§Ù„ØªØ¬Ø§Ø±Ø©.
  `.trim();
}
;

app.listen(PORT, () => {
  console.log('ðŸš€ Server running on port ' + PORT);
});
